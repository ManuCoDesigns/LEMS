// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// ENUMS
// ============================================

enum UserRole {
  SUPER_ADMIN
  SCHOOL_ADMIN
  TEACHER
  STUDENT
  PARENT
  GUEST
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum SchoolType {
  PRIMARY
  SECONDARY
  HIGH_SCHOOL
  COLLEGE
  UNIVERSITY
  MIXED
}

enum SchoolStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

// ============================================
// USER MANAGEMENT
// ============================================

model User {
  id       String     @id @default(uuid())
  email    String     @unique
  password String
  role     UserRole   @default(STUDENT)
  status   UserStatus @default(PENDING)

  // Personal Information
  firstName   String
  lastName    String
  middleName  String?
  dateOfBirth DateTime?
  gender      Gender?
  phone       String?
  avatar      String?

  // Address
  address    String?
  city       String?
  state      String?
  country    String?
  postalCode String?

  // Security
  emailVerified   Boolean   @default(false)
  emailVerifiedAt DateTime?
  lastLogin       DateTime?
  refreshToken    String?

  // Relations
  schoolId String?
  school   School? @relation(fields: [schoolId], references: [id], onDelete: SetNull)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([schoolId])
  @@index([email])
  @@index([role])
  @@map("users")
}

// ============================================
// SCHOOL MANAGEMENT
// ============================================

model School {
  id     String       @id @default(uuid())
  name   String
  code   String       @unique
  type   SchoolType
  status SchoolStatus @default(ACTIVE)

  // Contact Information
  email   String
  phone   String?
  website String?

  // Address
  address    String
  city       String
  state      String?
  country    String
  postalCode String?

  // Branding
  logo    String?
  motto   String?
  mission String?
  vision  String?

  // Settings
  currency String @default("KES")
  timezone String @default("Africa/Nairobi")
  language String @default("en")

  // Academic
  foundedYear   Int?
  principalName String?

  // Relations
  users         User[]
  departments   Department[]
  academicYears AcademicYear[]

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([code])
  @@index([status])
  @@map("schools")
}

// ============================================
// DEPARTMENT MANAGEMENT
// ============================================

model Department {
  id          String  @id @default(uuid())
  name        String
  code        String
  description String?

  // Relations
  schoolId String
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  // Head of Department
  hodName  String?
  hodEmail String?
  hodPhone String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([schoolId, code])
  @@index([schoolId])
  @@map("departments")
}

// ============================================
// ACADEMIC YEAR MANAGEMENT
// ============================================

model AcademicYear {
  id        String   @id @default(uuid())
  name      String
  startDate DateTime
  endDate   DateTime
  isCurrent Boolean  @default(false)

  // Relations
  schoolId String
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  terms Term[]

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([schoolId])
  @@index([isCurrent])
  @@map("academic_years")
}

// ============================================
// TERM/SEMESTER MANAGEMENT
// ============================================

model Term {
  id         String   @id @default(uuid())
  name       String
  termNumber Int
  startDate  DateTime
  endDate    DateTime
  isCurrent  Boolean  @default(false)

  // Relations
  academicYearId String
  academicYear   AcademicYear @relation(fields: [academicYearId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([academicYearId])
  @@index([isCurrent])
  @@map("terms")
}

// ============================================
// INDEXES FOR PERFORMANCE
// ============================================

// Additional indexes will be added as needed
